\thistype{ModulopGaussElimination}
\History{Thom Mulders}{8 July 96}{created OGE for general fields}
\History{Manuel Bronstein}{15 December 98}{adapted for machine primes}
\Usage{import from \this}
\begin{exports}
\asexp{deter}: & (M, Z, V, Z, Z, Z) $\to$ Z & Determinant\\
\asexp{determinant!}: & (M, Z, Z) $\to$ Z & Determinant\\
\asexp{extendedRowEchelon!}:
& (M, Z, Z, Z) $\to$ (V, Z, V, M) & REF of a matrix\\
\asexp{firstDependence!}:
& (\astype{Generator} V, Z, Z, M, M) $\to$ Z & First dependence relation\\
\asexp{inverse!}: & (M, Z, Z, M, V) $\to$ () & Inverse\\
\asexp{kernel!}: & (M, Z, Z, M) $\to$ Z & Kernel\\
\asexp{maxInvertibleSubmatrix!}: & (M, Z, Z) $\to$ (V, V) & Maximal minor\\
\asexp{particularSolution!}: & (M, Z, Z, M, Z, Z, M, V) $\to$ () & A solution\\
\asexp{rank!}: & (M, Z, Z, Z) $\to$ Z & Rank\\
\asexp{rowEchelon!}: & (M, Z, Z, Z) $\to$ (V, Z, V) & REF of a matrix\\
\asexp{solve!}: & (M, Z, Z, M, Z, Z, M, V, M) $\to$ Z & All solutions\\
\asexp{span!}: & (M, Z, Z) $\to$ V & Span\\
\end{exports}
\begin{aswhere}
Z &==& \astype{MachineInteger}\\
V &==& \astype{PrimitiveArray} \astype{MachineInteger}\\
M &==& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger}\\
\end{aswhere}
\Descr{
This domain implements ordinary Gaussian elimination on dense matrices
over the integers modulo a machine prime.
}
\aspage{deter}
\Usage{\name(a,n,$\sigma$,r,d,p)}
\Signature{(\astype{PrimitiveArray} \astype{PrimitiveArray} Z,Z,
\astype{PrimitiveArray} Z,Z,Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
\end{aswhere}
\Params{
{\em a} & A A \astype{MachineInteger} & A square matrix in REF form\\
{\em n} & \astype{MachineInteger} & The size of $a$\\
{\em $\sigma$} & A \astype{MachineInteger} &
A permutation of the rows of {\em a}\\
{\em r} & \astype{MachineInteger} & The number of stairs of the REF\\
{\em d} & \astype{MachineInteger} & The sign of $\sigma$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\begin{aswhere}
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Descr{
{\em (a,$\sigma$,r,d)} must be the representation of a REF computed by
either \asexp{extendedRowEchelon!} or \asexp{rowEchelon!}. The
determinant of the original matrix over $\ZZ/p\ZZ$ is returned.
}
\aspage{determinant!}
\Usage{\name(a,n,p)}
\Signature{(\astype{PrimitiveArray} \astype{PrimitiveArray} Z,Z,Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A square matrix\\
{\em n} & \astype{MachineInteger} & The size of $a$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\Retval{ Returns the determinant of {\em a} over $\ZZ/p\ZZ$.  }
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\aspage{extendedRowEchelon!}
\Usage{\name(a, r, c, p)}
\Signature{(A A Z,Z,Z)}{(A Z, Z, A Z, Z, A A Z)}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A matrix\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & A prime\\
}
\Descr{
We say that a matrix $a$ is in REF if there are $r$ (the rank) and
$j_1<j_2<\cdots<j_r$ (the stairs) such that $a(i,j_i)\neq 0$,
$a(i,j)=0$ for $j<j_i$ and $a(i,j)=0$ for $i>r$.

We say that a matrix $b$ is a REF of the matrix $a$ if $b$ is in REF
and there exists a non-singular matrix $u$ such that $ua=b$.

\bigskip
\name(a,r,c,p) computes a REF of {\em a} over $\ZZ/p\ZZ$.
It returns {\em ($\sigma$,r,st,d,w)}
where $\sigma$ is a permutation,
{\em r} is the number of stairs, {\em st} are the stairs,
{\em d} is the sign of $\sigma$ and {\em w} is a matrix.
For $i > r$, {\em st(i)} is set to $m+1$ where $m$ is the number of columns
of {\em a}.
For $j\ge j_i$ the entry $(i,j)$ of the REF is stored as entry
$(p(i),j)$ in {\em a}. The other entries of {\em a} may have random
values.
The entry $(i,j)$ of the transformation matrix {\em u} is stored as
entry $(p(i),j)$ in {\em w}.
}
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\alseealso{\asexp{rowEchelon!}}
\aspage{firstDependence!}
\Usage{\name(gen, n, p, a, d)}
\Signature{(\astype{Generator} A Z, Z, Z, A A Z, A A Z)}{Z}
\begin{aswhere}
A & == & \astype{PrimitiveArray}\\
Z & == & \astype{MachineInteger}\\
\end{aswhere}
\Params{
{\em gen}
& \astype{Generator} A \astype{MachineInteger} & A generator of vectors\\
{\em n} & \astype{MachineInteger} & The dimension of the vectors generated\\
{\em p} & \astype{MachineInteger} & a prime\\
{\em a} & A A \astype{MachineInteger} & A work matrix\\
{\em d} & A A \astype{MachineInteger} & A matrix for the dependence\\
}
\begin{aswhere}
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Descr{\name(gen,n,p,a,d) computes the first dependence over $\ZZ/p\ZZ$ among
the vectors generated by {\em gen}.
It returns the number $r$ of vectors generated. This number is as small
as possible, meaning that the first $r-1$ vectors are linearly independent
over $\ZZ/p\ZZ$. The coefficients of the dependence are stored in the
first column of $d$, which must have at least $r$ rows, upon return.
The work matrix $a$ must have $n$ rows
and at least $r$ columns (note that $r \le n+1$).
The dimension of the vectors generated by {\em gen} must be
{\em n}. There must be a relation between the vectors generated.}
\aspage{inverse!}
\Usage{\name(a,n,p,b,d)}
\Signature{(A A Z, Z, Z, A A Z, A Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a, b}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
Square matrices\\
{\em n} & \astype{MachineInteger} & The size of $a$, $b$ and $d$\\
{\em p} & \astype{MachineInteger} & a prime\\
{\em d} & \astype{PrimitiveArray} \astype{MachineInteger} & a vector\\
}
\Retval{ Fills $b$ and $d$ such that $d_i \in \{0,1\}$ for each $i$ and
$$
a b = \pmatrix{
d_0 &     &        & \cr
    & d_1 &        & \cr
    &     & \ddots & \cr
    &     &        & d_{n-1} \cr
}\,.
$$
}
\Remarks{$\prod_{i=0}^{n-1} d_i = 1$ if and only if $a$ is invertible,
in which case $b = a^{-1}$.
Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\aspage{kernel}
\Usage{\name(a,r,c,p,w)}
\Signature{(A A Z,Z,Z,A A Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a, w}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
Matrices\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\Retval{Stores a basis of the kernel of {\em a} in the columns of {\em w},
which must be large enough, and returns the dimension of the kernel.}
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\aspage{maxInvertibleSubmatrix!}
\Usage{\name(a,r,c,p)}
\Signature{(A A Z,Z,Z)}{(\astype{Array} Z, \astype{Array} Z)}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A matrix\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\Retval{ Returns $([r_1,\dots,r_r], [c_1,\dots,c_r])$
where $r$ is the rank of {\em a} over $\ZZ / p\ZZ$
and the submatrix of $a$ formed by the intersections of the rows $r_i$
and $c_i$ is invertible over $\ZZ / p\ZZ$.}
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\aspage{particularSolution!}
\Usage{\name(a,ra,ca,b,cb,p,w,d)}
\Signature{(A A Z,Z,Z,A A Z,Z,Z,A A Z,A Z)}{()}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a,b,w}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
Matrices\\
{\em ra} & \astype{MachineInteger} & Number of rows of $a$\\
{\em ca} & \astype{MachineInteger} & Number of columns of $a$\\
{\em cb} & \astype{MachineInteger} & Number of columns of $b$\\
{\em p} & \astype{MachineInteger} & a prime\\
{\em d} & \astype{PrimitiveArray} \astype{MachineInteger} & a vector\\
}
\Retval{ Fills $w$ and $d$ such that $d_i \in \{0,1\}$ for each $i$ and
$$
a w = b \pmatrix{
d_0 &     &        & \cr
    & d_1 &        & \cr
    &     & \ddots & \cr
    &     &        & d_{n-1} \cr
}\,.
$$
\Remarks{For each $i$, $d_i = 1$ if and only if the system
$a x = \sth{(i+1)}$ column of $b$ has a solution, which is then
the $\sth{(i+1)}$ column of $w$, which must have the same dimensions
than $b$, which must have the same number of rows that $a$.
Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$,
while $b$ is not modified.}
}
\aspage{rank!}
\Usage{\name(a,r,c,p)}
\Signature{(\astype{PrimitiveArray} \astype{PrimitiveArray} Z,Z,Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A matrix\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\Retval{ Returns the rank of {\em a} over $\ZZ/p\ZZ$.  }
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\aspage{rowEchelon!}
\Usage{\name(a, r, c, p)}
\Signature{(A A Z,Z,Z)}{(A Z, Z, A Z, Z)}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A matrix\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & A prime\\
}
\Descr{
We say that a matrix $a$ is in REF if there are $r$ (the rank) and
$j_1<j_2<\cdots<j_r$ (the stairs) such that $a(i,j_i)\neq 0$,
$a(i,j)=0$ for $j<j_i$ and $a(i,j)=0$ for $i>r$.

We say that a matrix $b$ is a REF of the matrix $a$ if $b$ is in REF
and there exists a non-singular matrix $u$ such that $ua=b$.

\bigskip
\name(a,r,c,p) computes a REF of {\em a} over $\ZZ/p\ZZ$.
It returns {\em ($\sigma$,r,st,d)}
where $\sigma$ is a permutation, {\em r} is the
number of stairs, {\em st} are the stairs and {\em d} is the sign of {\em p}.
For $i > r$, {\em st(i)} is set to $m+1$ where $m$ is the number of columns
of {\em a}.
For $j\ge j_i$ the entry $(i,j)$ of the REF is stored as entry
$(p(i),j)$ in {\em a}. The other entries of {\em a} may have random values.
}
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
\alseealso{\asexp{extendedRowEchelon!}}
\aspage{solve!}
\Usage{\name(a,ra,ca,b,cb,p,w,d,k)}
\Signature{(A A Z,Z,Z,A A Z,Z,Z,A A Z,A Z,A A Z)}{Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
A & == & \astype{PrimitiveArray}\\
\end{aswhere}
\Params{
{\em a,b,w,k}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
Matrices\\
{\em ra} & \astype{MachineInteger} & Number of rows of $a$\\
{\em ca} & \astype{MachineInteger} & Number of columns of $a$\\
{\em cb} & \astype{MachineInteger} & Number of columns of $b$\\
{\em p} & \astype{MachineInteger} & a prime\\
{\em d} & \astype{PrimitiveArray} \astype{MachineInteger} & a vector\\
}
\Retval{ Fills $w$ and $d$ such that $d_i \in \{0,1\}$ for each $i$ and
$$
a w = b \pmatrix{
d_0 &     &        & \cr
    & d_1 &        & \cr
    &     & \ddots & \cr
    &     &        & d_{n-1} \cr
}\,.
$$
Furthermore, \name~stores a basis of the kernel of {\em a} in the columns of
{\em k},
which must be large enough, and returns the dimension of the kernel.}
\Remarks{For each $i$, $d_i = 1$ if and only if the system
$a x = \sth{(i+1)}$ column of $b$ has a solution, which is then
the $\sth{(i+1)}$ column of $w$, which must have the same dimensions
than $b$, which must have the same number of rows that $a$.
Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$,
while $b$ is not modified.}
\aspage{span!}
\Usage{\name(a,r,c,p)}
\Signature{(\astype{PrimitiveArray} \astype{PrimitiveArray} Z,Z,Z)}
{\astype{Array} Z}
\begin{aswhere}
Z & == & \astype{MachineInteger}\\
\end{aswhere}
\Params{
{\em a}
& \astype{PrimitiveArray} \astype{PrimitiveArray} \astype{MachineInteger} &
A matrix\\
{\em r} & \astype{MachineInteger} & Number of rows of $a$\\
{\em c} & \astype{MachineInteger} & Number of columns of $a$\\
{\em p} & \astype{MachineInteger} & a prime\\
}
\Retval{ Returns $[c_1,\dots,c_r]$ where $r$ is the rank of {\em a}
over $\ZZ/p\ZZ$
and the span of $a$ is generated by its columns $c_1,\dots,c_r$.}
\Remarks{Does not make a copy of $a$, but performs all the
computations in--place, modifying the entries of $a$.}
